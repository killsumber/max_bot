<!-- web_app/templates/tasks.html -->
{% extends "base.html" %}

{% block title %}–ó–∞–¥–∞—á–∏ - TaskMax{% endblock %}

{% block content %}
<div class="tasks-header">
    <h2>üìã –ú–æ–∏ –∑–∞–¥–∞—á–∏</h2>
    
    <div class="filters">
        <a href="{{ url_for('tasks') }}?status=all" class="filter-btn {% if status_filter == 'all' %}active{% endif %}">
            –í—Å–µ ({{ tasks|length }})
        </a>
        <a href="{{ url_for('tasks') }}?status=active" class="filter-btn {% if status_filter == 'active' %}active{% endif %}">
            –ê–∫—Ç–∏–≤–Ω—ã–µ
        </a>
        <a href="{{ url_for('tasks') }}?status=completed" class="filter-btn {% if status_filter == 'completed' %}active{% endif %}">
            –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ
        </a>
    </div>
</div>

{% if tasks %}
<div class="tasks-list">
    {% for task in tasks %}
    <div class="task-card {% if not task.status_in_work %}completed{% endif %}">
        <div class="task-header">
            <h3 class="task-title">{{ task.title }}</h3>
            <div class="task-priority priority-{{ task.priority }}">
                {% if task.priority == 2 %}üî• –í—ã—Å–æ–∫–∏–π
                {% elif task.priority == 1 %}‚ö° –°—Ä–µ–¥–Ω–∏–π
                {% else %}‚ö™ –ù–∏–∑–∫–∏–π{% endif %}
            </div>
        </div>
        
        {% if task.description %}
        <p class="task-description">{{ task.description }}</p>
        {% endif %}
        
        <div class="task-meta">
            <span class="task-date">–°–æ–∑–¥–∞–Ω–∞: {{ task.created_at.strftime('%d.%m.%Y %H:%M') }}</span>
            {% if task.due_date %}
            <span class="task-due">–°—Ä–æ–∫: {{ task.due_date.strftime('%d.%m.%Y %H:%M') }}</span>
            {% endif %}
        </div>
        
        <div class="task-actions">
            <form action="{{ url_for('toggle_task', task_id=task.id) }}" method="post" class="inline-form">
                <button type="submit" class="btn btn-sm {% if task.status_in_work %}btn-warning{% else %}btn-success{% endif %}">
                    {% if task.status_in_work %}‚úÖ –í—ã–ø–æ–ª–Ω–∏—Ç—å{% else %}‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å{% endif %}
                </button>
            </form>
            
            <form action="{{ url_for('update_priority', task_id=task.id) }}" method="post" class="inline-form">
                <select name="priority" onchange="this.form.submit()" class="priority-select">
                    <option value="0" {% if task.priority == 0 %}selected{% endif %}>–ù–∏–∑–∫–∏–π</option>
                    <option value="1" {% if task.priority == 1 %}selected{% endif %}>–°—Ä–µ–¥–Ω–∏–π</option>
                    <option value="2" {% if task.priority == 2 %}selected{% endif %}>–í—ã—Å–æ–∫–∏–π</option>
                </select>
            </form>
            
            <form action="{{ url_for('delete_task', task_id=task.id) }}" method="post" class="inline-form">
                <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É?')">
                    üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                </button>
            </form>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="empty-state">
    <p>üìù –ó–∞–¥–∞—á –ø–æ–∫–∞ –Ω–µ—Ç</p>
    <a href="{{ url_for('create_task') }}" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—É—é –∑–∞–¥–∞—á—É</a>
</div>
{% endif %}
{% endblock %}